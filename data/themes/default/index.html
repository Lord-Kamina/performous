<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<title>Performous web frontend</title>

	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css">
	<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
</head>
<body>

<!-- Home -->
<div data-role="page" id="page1">
	<div data-theme="a" data-role="header">
		<h3>Performous web frontend</h3>
		<div data-role="navbar" data-iconpos="top">
			<ul>
				<li><a href="#page1" data-transition="flip" data-theme="" data-icon="plus" data-iconpos="top" class="ui-btn-active ui-state-persist">
					Add songs
				</a></li>
				<li><a href="#page2" data-transition="flip" data-theme="" data-icon="grid" data-iconpos="top">
					View playlist
				</a></li>
				<li><a href="#page3" data-transition="flip" data-theme="" data-icon="search" data-iconpos="top">
					Search v2.0ùõÉ
				</a>
				</li>
			</ul>
		</div>
	</div>
	<div data-role="content">
		<ul data-role="listview" id="songListViewer" data-divider-theme="b" data-filter="true">
			<li data-role="list-divider" role="heading">
				Available songs:
			</li>
		</ul>
		<br> <br> <br>
		<a id="databaseRefreshButton" data-role="button" href="#page1" data-icon="refresh" data-iconpos="top">
			Refresh database
		</a>
	</div>
</div>

<!-- Playlist -->
<div data-role="page" id="page2">
	<div data-theme="a" data-role="header">
		<h3>Performous web frontend</h3>
		<div data-role="navbar" data-iconpos="top">
			<ul>
				<li><a href="#page1" data-transition="flip" data-theme="" data-icon="plus" data-iconpos="top">
					Add songs
				</a></li>
				<li><a href="#page2" data-transition="flip" data-theme="" data-icon="grid" data-iconpos="top" class="ui-btn-active ui-state-persist">
					View playlist
				</a></li>
				<li><a href="#page3" data-transition="flip" data-theme="" data-icon="search" data-iconpos="top">
					Search v2.0ùõÉ
				</a>
				</li>
			</ul>
		</div>
	</div>
	<div data-role="content">
		<ul data-role="listview" id="playListView" data-divider-theme="b">
			<li data-role="list-divider" role="heading">
				Upcoming songs:
			</li>
		</ul>
		<br> <br>

		<div class="ui-block-d1">
			<a id="playlistRefreshButton" data-role="button" href="#page2" data-icon="refresh" data-iconpos="top">
				Refresh Playlist
			</a>
		</div>
		<br>
		<div data-role="fieldcontain">
			<label for="flipupdate">Update every 30 sec.</label>
			<select name="flipupdate" id="flipupdate" data-role="slider" data-mini="false">
				<option value="off">No</option>
				<option value="on">Yes</option>
			</select>
		</div>
		<small>Web interface by Niek Nooijens, for full credits regarding Performous see /docs/Authors.txt</small>
	</div>
</div>
<div data-role="page" id="page3">
	<div data-theme="a" data-role="header">
		<h3>Performous web frontend</h3>
		<div data-role="navbar" data-iconpos="top">
			<ul>
				<li><a href="#page1" data-transition="flip" data-theme="" data-icon="plus" data-iconpos="top">
					Add songs
				</a></li>
				<li><a href="#page2" data-transition="flip" data-theme="" data-icon="grid" data-iconpos="top">
					View playlist
				</a></li>
				<li><a href="#page3" data-transition="flip" data-theme="" data-icon="search" data-iconpos="top" class="ui-btn-active ui-state-persist">
					Search v2.0ùõÉ
				</a>
				</li>
			</ul>
		</div>
	</div>
	<div data-role="content">
	<div class="ui-grid-a">
            <div class="ui-block-a">
                <div data-role="fieldcontain"> <input type="search" name="searchv2" id="searchv2" value="search for songs" />
	 </div>
            </div>
            <div class="ui-block-b"> <a id="databaseSearchButton" data-role="button" href="#page3" data-icon="search">
			Search
		</a> </div> </div> <br> <br>
		<ul data-role="listview" id="searchResultsViewer" data-divider-theme="b">
			<li data-role="list-divider" role="heading">
				Available songs:
			</li>
		</ul>
</div>
</div>

<script>
	var update = false;
	var database = {};
	var songlist = {};

	<!-- Home -->

	$("#databaseRefreshButton").bind ("click", function(event) {
		$.get("api/getDataBase.json", function(data) {
			database = JSON.parse(data);
			$('#songListViewer').html('<li data-role="list-divider" role="heading">Available songs:</li> <li data-theme="c">\n');
			for (i in database) {
				$('#songListViewer').append('<li data-theme="c" data-icon="plus"><a href="javascript:AddSong('+ i + ')" data-transition="slide">' + database[i].Artist + ' - ' + database[i].Title + '</a></li>\n');
			}
			$('#songListViewer').listview('refresh');
		});
	});

	function AddSong(number) {
		$.post("api/add", JSON.stringify(database[number]));
		RefreshPlayList();
	}

	<!-- Playlist -->

	$("#playlistRefreshButton").bind ("click", function(event) {
		RefreshPlayList();
	});

	function RefreshPlayList() {
		$.get("api/getCurrentPlaylist.json", function(data){
		songlist = JSON.parse(data);
		$('#playListView').html('<li data-role="list-divider" role="heading">Upcoming songs:</li><li data-theme="c">\n');
			for (i in songlist) {
				var count = parseInt(i,10) + parseInt(1,10);
				$('#playListView').append('<li data-theme="c" data-icon="info"><a href="javascript:ViewInfo(' + i + ')" data-transition="slide"> #' + count + ' ' + songlist[i].Artist + ' - ' + songlist[i].Title + '</a></li>\n');
			}
			$('#playListView').listview('refresh');
		});
	}

$("#databaseSearchButton").bind ("click", function (event) {
	DoQuery();
});

$(document).keypress(function(e) {
    if(e.which == 13) {
       DoQuery();
    }
});

	function DoQuery() {
	var query = $('#searchv2').val();
		
	results = $.post("api/search",query, function (data) {
	database = JSON.parse(data);
			$('#searchResultsViewer').html('<li data-role="list-divider" role="heading">Available songs:</li> <li data-theme="c">\n');
			for (i in database) {
				$('#searchResultsViewer').append('<li data-theme="c" data-icon="plus"><a href="javascript:AddSong('+ i + ')" data-transition="slide">' + database[i].Artist + ' - ' + database[i].Title + '</a></li>\n');
			}
			$('#searchResultsViewer').listview('refresh');
});
}
	<!-- TODO: confirm boxes are ugly, use jqm's dialogs -->
	function ViewInfo(songnumber) {
		if (confirm("Title: " + songlist[songnumber].Title + "\nArtist: " + songlist[songnumber].Artist + 
			"\nEdition: " + songlist[songnumber].Edition + "\nLanguage: " + songlist[songnumber].Language + "\nCreator: " 
			+ songlist[songnumber].Creator + "\n \n Do you want to Remove this song from the list?"))
		{
			$.post("api/remove", songnumber.toString());
			RefreshPlayList();
		}
	}

	$('#flipupdate').bind("change", function(event, ui) {
		update = !update;
	});

	window.setInterval(function(){
		if (update) RefreshPlayList();
	}, 30000);

</script>

</body>
</html>
