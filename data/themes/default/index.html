<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <title></title>
  
  
  
  <link rel="stylesheet" href="https://d10ajoocuyu32n.cloudfront.net/mobile/1.3.1/jquery.mobile-1.3.1.min.css">
  
  <!-- Extra Codiqa features -->
  <link rel="stylesheet" href="codiqa.ext.css">
  
  <!-- jQuery and jQuery Mobile -->
  <script src="https://d10ajoocuyu32n.cloudfront.net/jquery-1.9.1.min.js"></script>
  <script src="https://d10ajoocuyu32n.cloudfront.net/mobile/1.3.1/jquery.mobile-1.3.1.min.js"></script>

  
  <!--script bindings-->
  <script>
    $(document).bind ("mobileinit", function ()
    {
      alert ("mobileinit");

    });
  </script> 
   
</head>
<body>
<!-- Home -->
<div data-role="page" id="page1">
    <div data-theme="a" data-role="header">
        <h3>
            Performous web frontend
        </h3>
        <div data-role="navbar" data-iconpos="top">
            <ul>
                <li>
                    <a href="#page1" data-transition="flip" data-theme="" data-icon="plus" data-iconpos="top" class="ui-btn-active ui-state-persist">
                        Add songs
                    </a>
                </li>
                <li>
                    <a href="#page2" data-transition="flip" data-theme="" data-icon="grid" data-iconpos="top">
                        View playlist
                    </a>
                </li>
            </ul>
        </div>
    </div>
    <div data-role="content">
        <ul data-role="listview" id="SongListViewer" data-divider-theme="b" data-filter="true">
            <li data-role="list-divider" role="heading">
                Available songs
            </li>
            <li data-theme="c">
            </li>
        </ul>
        
        <br> <br> <br>
                <a id="databaseRefreshButton" data-role="button" href="#page1" data-icon="refresh" data-iconpos="top">
                    Refresh database
                </a>
        </div>
    </div>
</div>

<!--page 2 PLAYLIST!!!!-->
<div data-role="page" id="page2">
    <div data-theme="a" data-role="header">
        <h3>
            Performous web frontend
        </h3>
        <div data-role="navbar" data-iconpos="top">
            <ul>
                <li>
                    <a href="#page1" data-transition="flip" data-theme="" data-icon="plus" data-iconpos="top">
                        Add songs
                    </a>
                </li>
                <li>
                    <a href="#page2" data-transition="flip" data-theme="" data-icon="grid" data-iconpos="top" class="ui-btn-active ui-state-persist">
                        View playlist
                    </a>
                </li>
            </ul>
        </div>
    </div>
    <div data-role="content">	
    <ul data-role="listview" id="PlayListView" data-divider-theme="b">
            <li data-role="list-divider" role="heading">
                Upcoming songs:
            </li>
            <li data-theme="c">
            </li>
        </ul>
			<br> <br>        
        
            <div class="ui-block-d1">
                <a id="playlistRefreshButton" data-role="button" href="#page2" data-icon="refresh" data-iconpos="top">
                    Refresh Playlist
                </a>
      		</div>
      		<br>
      		<div data-role="fieldcontain">
<label for="flipupdate">Update every 30 sec.</label>
<select name="flipupdate" id="flipupdate" data-role="slider" data-mini="false">
<option value="off">No</option>
<option value="on">Yes</option>
</select>
</div> 
<small> Web interface by Niek Nooijens, for full credits regarding Performous see /docs/Authors.txt</small>
	</div>
</div>

</body>
</html>


<!-- down here will be all functions -->
 <script>

<!-- page 1-->
$(document).ready (function ()
{
	update = false;
  alert ("Welcome to the web-control of performous! here you can view the current playlist and add songs to it.");

});


</script>

<script>

 $("#databaseRefreshButton").bind ("click", function (event)
{
 $.get("api/getDataBase.json", function(data) {
$('#SongListViewer').empty();
  DataBase = JSON.parse(data);
  $('#SongListViewer').append("<li data-role=\"list-divider\" role=\"heading\">Available songs </li> <li data-theme=\"c\">\n");
  
  for (i in DataBase) {
 $('#SongListViewer').append(" <li data-theme=\"c\" data-icon=\"plus\"><a href=\"javascript:AddSong("+ i + ")\" data-transition=\"slide\">" + DataBase[i].Artist + " - " + DataBase[i].Title + "</a> </li>\n");
}  
$('#SongListViewer').listview('refresh');
});
});

</script>

<script>
function AddSong(number) {
$.post("api/add", JSON.stringify(DataBase[number]));
RefreshPlayList();
}
</script>


<!-- page 2-->
<script>

 $("#playlistRefreshButton").bind ("click", function (event)
{
 RefreshPlayList();
});
</script>
<script>
function RefreshPlayList() {
$.get("api/getCurrentPlaylist.json", function(data){
$('#PlayListView').empty();
 SongList = JSON.parse(data);
 $('#PlayListView').append("<li data-role=\"list-divider\" role=\"heading\">Upcoming songs: </li> <li data-theme=\"c\">\n");
	for(i in SongList) {
	var count = parseInt(i,10) + parseInt(1,10);
 	$('#PlayListView').append("<li data-theme=\"c\" data-icon=\"info\"><a href=\"javascript:ViewInfo("+ i + ")\" data-transition=\"slide\"> #" + count + " " + SongList[i].Artist + " - " + SongList[i].Title + "</a></li>\n");
	}
	$('#PlayListView').listview('refresh');
});
}
</script>

<script>
function ViewInfo(songnumber) {
if(confirm("Title: " + SongList[songnumber].Title + "\nArtist: " + SongList[songnumber].Artist + 
"\nEdition: " + SongList[songnumber].Edition + "\nLanguage: " + SongList[songnumber].Language + "\nCreator: " 
+ SongList[songnumber].Creator + "\n \n Do you want to Remove this song from the list?")) {
$.post("api/remove",songnumber.toString());
RefreshPlayList();
}
}
</script>

<script> <!-- togglebutton-->
$( '#flipupdate' ).bind( "change", function(event, ui) {
 if(update) {
	update = false; 
 } else {
	update = true; 
 }
});

window.setInterval(function(){
if(update) {
	RefreshPlayList();
}

}, 30000);
</script>


